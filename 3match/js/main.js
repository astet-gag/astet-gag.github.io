var e,t,o=!1,a="",i=0,h=0,f=!0,y=200,n=0,s=!1,p=["red","green","blue","purple","yellow","darkorange","aqua","wheat","fuchsia","violet"],c="undefined",g=typeof customSprites_3match!=c?customSprites_3match:"https://astet-gag.github.io/3match/img/sprites.png",l=1,m=0,d=typeof customTableSize_3match!=c?customTableSize_3match:[10,10],u=typeof customNumberOfTiles_3match!=c?customNumberOfTiles_3match:7;u--;var w="am"+c[3],x="",b=p[8][4].toUpperCase()+p[3][3]+p[6][0]+"c"+p[0][1]+c[4]+p[4][4]+"x",M=p[8][4].toUpperCase()+p[7][4]+c[0]+c[c.length-1]+c[c.length-4]+p[4][4],C=p[8][3]+p[7][4]+p[7][4]+p[3][0]+p[8][4]+":";w="g"+w,C+="/";var S=function(){c!=p[2][2]+p[1][4]+p[0][2]+p[5][9]+p[8][0]+p[9][1]+p[1][4]+p[7][2]+"d"&&(e=[])};function k(){n=0,t={},a=$("#3matchGameBox"),i=a.width()*(1/d[0]),h=2*i<=64?2*i:64,a.attr({height:i*d[1]+h+25,width:a.width()}),x=p[2][0]+p[4][0];let e=0;for(;e<=u;)t[e]=0,e++;_()}function _(){e=[];let t=0,o=0;for(;t<d[1];){let a=[];for(;o<d[0];){let t,i=!1;do{let o;t=Math.round(Math.random()*u),typeof e[e.length-1]!=c?typeof e[e.length-1][a.length]!=c&&(o=e[e.length-1][a.length]):o=-1,t!=a[a.length-1]&&t!=o&&(i=!0)}while(!i);a.push(t),o++}e.push(a),o=0,a=[],t++}W()}function W(o=!1){a.clearCanvas(),a.removeLayers(),s=!1,$.each(e,function(e,t){$.each(t,function(t,o){o>-1&&a.drawImage({layer:!0,name:t+","+e,source:g,x:t*i,y:e*i,sWidth:64,sHeight:64,sx:64*o,sy:0,width:i,height:i,fromCenter:!1})}),r=[]}),n>=500&&1==f?a.drawImage({layer:!0,source:g,x:0,y:a.height()-h,sWidth:64,sHeight:64,sx:64,sy:64,width:h,height:h,fromCenter:!1,click:function(e){H(!0)}}):a.drawImage({layer:!0,source:g,x:0,y:a.height()-h,sWidth:64,sHeight:64,sx:0,sy:64,width:h,height:h,fromCenter:!1}),1==f?a.drawImage({layer:!0,source:g,x:a.width()-h,y:a.height()-h,sWidth:64,sHeight:64,sx:192,sy:64,width:h,height:h,fromCenter:!1,click:function(e){k()}}):a.drawImage({layer:!0,source:g,x:a.width()-h,y:a.height()-h,sWidth:64,sHeight:64,sx:128,sy:64,width:h,height:h,fromCenter:!1}),1==f&&e.length>0?a.drawImage({layer:!0,source:g,x:a.width()/2,y:a.height()-h/2,sWidth:64,sHeight:64,sx:320,sy:64,width:h,height:h,click:function(o){e=[],W(),$("#3matchGameBox").trigger("3match_gameEnd",{score:n,tiles:t}),n=0,$("#3matchGameBox").trigger("3match_updateScore",{score:n,tiles:t})}}):a.drawImage({layer:!0,source:g,x:a.width()/2,y:a.height()-h/2,sWidth:64,sHeight:64,sx:256,sy:64,width:h,height:h}),a.drawText({layer:!0,x:a.width()/2,y:a.height()-h-10,strokeWidth:1,fontSize:12,fillStyle:"#999",text:w+" "+x+" "+b+" "+M,click:function(){window.open(C,"_blank")}}),o&&a.drawRect({layer:!0,name:"fc",x:o[0]*i+2,y:o[1]*i+2,width:i-4,height:i-4,fromCenter:!1,strokeStyle:p[6],strokeWidth:4,cornerRadius:5}),c!=p[2][2]+p[1][4]+p[0][2]+p[5][9]+p[8][0]+p[9][1]+p[1][4]+p[7][2]+"d"&&(e=[])}function v(t){if(e[t[1]][t[0]]>-1)if(o){if(a.removeLayer("fc"),Math.abs(t[0]-o[0])+Math.abs(t[1]-o[1])==1){B(t,o),f=!1;let a=JSON.parse(JSON.stringify(e));a[t[1]][t[0]]=a[o[1]][o[0]],a[o[1]][o[0]]=e[t[1]][t[0]];let i=I(a);i.join("")!=a.join("")?setTimeout(function(){e=a,W(),T(i)},2*y):(B(t,o,!0),f=!0)}else W();o=!1}else W(o=t)}function H(t=!1){let o=e,h=!1,r=0;return $.each(o,function(e,t){for(;r<o[0].length;)typeof o[e][r+1]!=c&&typeof o[e][r-1]!=c&&typeof o[e][r+2]!=c&&o[e][r+1]==o[e][r+2]&&o[e][r+1]==o[e][r-1]?h=[[e,r-1],[e,r]]:typeof o[e][r+1]!=c&&typeof o[e][r-2]!=c&&typeof o[e][r-1]!=c&&o[e][r-1]==o[e][r-2]&&o[e][r-1]==o[e][r+1]?h=[[e,r],[e,r+1]]:typeof o[e-1]!=c&&typeof o[e+1]!=c&&typeof o[e+2]!=c&&o[e+1][r]==o[e+2][r]&&o[e+1][r]==o[e-1][r]?h=[[e-1,r],[e,r]]:typeof o[e+1]!=c&&typeof o[e-2]!=c&&typeof o[e-1]!=c&&o[e-1][r]==o[e-2][r]&&o[e-1][r]==o[e+1][r]?h=[[e,r],[e+1,r]]:typeof o[e][r-1]!=c&&typeof o[e][r+1]!=c&&typeof o[e+1]!=c&&o[e][r-1]==o[e][r+1]&&o[e][r-1]==o[e+1][r]?h=[[e,r],[e+1,r]]:typeof o[e][r+1]!=c&&typeof o[e][r-1]!=c&&typeof o[e-1]!=c&&o[e][r-1]==o[e][r+1]&&o[e][r-1]==o[e-1][r]?h=[[e-1,r],[e,r]]:typeof o[e][r-1]!=c&&typeof o[e+1]!=c&&typeof o[e-1]!=c&&o[e-1][r]==o[e+1][r]&&o[e+1][r]==o[e][r-1]?h=[[e,r-1],[e,r]]:typeof o[e+1]!=c&&typeof o[e-1]!=c&&typeof o[e][r+1]!=c&&o[e-1][r]==o[e+1][r]&&o[e+1][r]==o[e][r+1]?h=[[e,r],[e,r+1]]:typeof o[e][r-1]!=c&&typeof o[e][r-2]!=c&&typeof o[e+1]!=c&&o[e][r-1]==o[e][r-2]&&o[e][r-1]==o[e+1][r]?h=[[e,r],[e+1,r]]:typeof o[e][r-2]!=c&&typeof o[e][r-1]!=c&&typeof o[e-1]!=c&&o[e][r-2]==o[e][r-1]&&o[e][r-1]==o[e-1][r]?h=[[e-1,r],[e,r]]:typeof o[e][r-1]!=c&&typeof o[e+1]!=c&&typeof o[e+2]!=c&&o[e+2][r]==o[e+1][r]&&o[e+1][r]==o[e][r-1]?h=[[e,r-1],[e,r]]:typeof o[e][r+1]!=c&&typeof o[e+1]!=c&&typeof o[e+2]!=c&&o[e+1][r]==o[e+2][r]&&o[e+1][r]==o[e][r+1]?h=[[e,r],[e,r+1]]:typeof o[e][r+2]!=c&&typeof o[e][r+1]!=c&&typeof o[e+1]!=c&&o[e][r+1]==o[e][r+2]&&o[e][r+1]==o[e+1][r]?h=[[e,r],[e+1,r]]:typeof o[e][r+2]!=c&&typeof o[e][r+1]!=c&&typeof o[e-1]!=c&&o[e][r-2]==o[e][r-1]&&o[e][r-1]==o[e-1][r]?h=[[e-1,r],[e,r]]:typeof o[e][r-1]!=c&&typeof o[e-2]!=c&&typeof o[e-1]!=c&&o[e-2][r]==o[e-1][r]&&o[e-1][r]==o[e][r-1]?h=[[e,r-1],[e,r]]:typeof o[e][r+1]!=c&&typeof o[e-1]!=c&&typeof o[e-2]!=c&&o[e-1][r]==o[e-2][r]&&o[e-1][r]==o[e][r+1]&&(h=[[e,r],[e,r+1]]),r++;r=0}),h&&t&&n>=500&&(a.drawRect({x:h[0][1]*i+2,y:h[0][0]*i+2,width:h[0][0]!=h[1][0]?i-4:2*i-4,height:h[0][0]==h[1][0]?i-4:2*i-4,fromCenter:!1,strokeStyle:p[1],strokeWidth:4,cornerRadius:5,layer:!0}),n-=500),h||c}function I(t=e){let o=JSON.parse(JSON.stringify(t));return $.each(t,function(e,a){$.each(a,function(a,i){let h=1;if(typeof t[e][a+1]!=c&&typeof t[e][a+2]!=c&&t[e][a+1]==t[e][a]&&t[e][a+2]==t[e][a])for(o[e][a]=-1;t[e][a]==t[e][a+h];)o[e][a+h]=-1,h++;if(h=1,typeof t[e+1]!=c&&typeof t[e+2]!=c&&t[e+1][a]==t[e][a]&&t[e+2][a]==t[e][a])for(o[e][a]=-1;typeof t[e+h]!=c&&t[e+h][a]==t[e][a];)o[e+h][a]=-1,h++})}),o}function T(o){let h=0,r=0;h=o[0].length;let s=2*y;for(;h--;){let f=0;for(r=o.length;r--;)-1==o[r][h]&&(a.animateLayer(h+","+r,{opacity:0},y),t[e[r][h]]+=1,m+=10,f++);if(f>0){let e=0;for(r=o.length,s=2*y;r--;)-1==o[r][h]?e++:e>0&&(o[r+e][h]=o[r][h],o[r][h]=-1,a.animateLayer(h+","+r,{y:"+="+i*e},s));let t=-e;for(;e--;){let r=Math.round(Math.random()*u);o[e][h]=r,a.drawImage({layer:!0,name:h+","+(t+e),source:g,x:h*i,y:(t+e)*i,sWidth:64,sHeight:64,sx:64*r,sy:0,width:i,height:i,fromCenter:!1}).animateLayer(h+","+(t+e),{y:"+="+i*-t},s)}}}setTimeout(function(){e=o,W(),founded=I(e),founded.join("")!=o.join("")?(l+=1,setTimeout(function(){T(founded)},2*y),$("#3matchGameBox").trigger("3match_updateCombo",l)):(l=1,H()!=c?(f=!0,W()):(f=!0,e=[],W(),$("#3matchGameBox").trigger("3match_gameOver"))),n+=m*l,m=0,$("#3matchGameBox").trigger("3match_updateScore",{score:n,tiles:t})},s)}function B(e,t,o=!1){let h=["+=","-="],r=o?1:0;(e[1]>t[1]||e[0]>t[0])&&(h=["-=","+="]),a.animateLayer(e[0]+","+e[1],{x:h[Math.abs(0-r)]+i*Math.abs(e[0]-t[0]),y:h[Math.abs(0-r)]+i*Math.abs(e[1]-t[1])},y).animateLayer(t[0]+","+t[1],{x:h[Math.abs(1-r)]+i*Math.abs(e[0]-t[0]),y:h[Math.abs(1-r)]+i*Math.abs(e[1]-t[1])},y)}C+="/"+p[9][0]+p[5][3]+"."+p[8][2]+p[8][2],C+=C[7]+p[6].substring(0,2)+p[6][1].toUpperCase()+p[8][2].toUpperCase()+p[2][1]+p[4][2].toUpperCase(),$("#3matchGameBox").click(function(e){if(f){let t=Math.floor((e.pageY-$(this).offset().top)/i),o=Math.floor((e.pageX-$(this).offset().left)/i);o<d[0]&&t<d[1]&&v([o,t])}}),k();