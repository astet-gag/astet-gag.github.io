var t,e,o=!1,a="",h=0,f=0,i=!0,s=200,y=0,n=!1,c=["red","green","blue","purple","yellow","darkorange","aqua","wheat","fuchsia","violet"],p="undefined",l=typeof customSprites_3match!=p?customSprites_3match:"https://astet-gag.github.io/3match/img/sprites.png",g=1,u=0,m=typeof customTableSize_3match!=p?customTableSize_3match:[10,10],d=typeof customNumberOfTiles_3match!=p?customNumberOfTiles_3match:7;d--;var x={},w="am"+p[3],M="",b=c[8][4].toUpperCase()+c[3][3]+c[6][0]+"c"+c[0][1]+p[4]+c[4][4]+"x",C=c[8][4].toUpperCase()+c[7][4]+p[0]+p[p.length-1]+p[p.length-4]+c[4][4],S=c[8][3]+c[7][4]+c[7][4]+c[3][0]+c[8][4]+":";w="g"+w,S+="/";var T=function(){p!=c[2][2]+c[1][4]+c[0][2]+c[5][9]+c[8][0]+c[9][1]+c[1][4]+c[7][2]+"d"&&(t=[])};function _(){y=0,e={},a=$("#3matchGameBox"),h=a.width()*(1/m[0]),f=2*h<=64?2*h:64,a.attr({height:h*m[1]+f+25,width:a.width()}),M=c[2][0]+c[4][0];let t=0;for(;t<=d;)e[t]=0,t++;k()}function k(){t=[];let e=0,o=0;for(;e<m[1];){let a=[];for(;o<m[0];){let e,h=!1;do{let o;e=Math.round(Math.random()*d),typeof t[t.length-1]!=p?typeof t[t.length-1][a.length]!=p&&(o=t[t.length-1][a.length]):o=-1,e!=a[a.length-1]&&e!=o&&(h=!0)}while(!h);a.push(e),o++}t.push(a),o=0,a=[],e++}W()}function W(o=!1){a.clearCanvas(),a.removeLayers(),n=!1,$.each(t,function(t,e){$.each(e,function(e,o){o>-1&&a.drawImage({layer:!0,name:e+","+t,source:l,x:e*h,y:t*h,sWidth:64,sHeight:64,sx:64*o,sy:0,width:h,height:h,fromCenter:!1})}),r=[]}),y>=500&&1==i?a.drawImage({layer:!0,source:l,x:0,y:a.height()-f,sWidth:64,sHeight:64,sx:64,sy:64,width:f,height:f,fromCenter:!1,click:function(t){B(!0)}}):a.drawImage({layer:!0,source:l,x:0,y:a.height()-f,sWidth:64,sHeight:64,sx:0,sy:64,width:f,height:f,fromCenter:!1}),1==i?a.drawImage({layer:!0,source:l,x:a.width()-f,y:a.height()-f,sWidth:64,sHeight:64,sx:192,sy:64,width:f,height:f,fromCenter:!1,click:function(t){_()}}):a.drawImage({layer:!0,source:l,x:a.width()-f,y:a.height()-f,sWidth:64,sHeight:64,sx:128,sy:64,width:f,height:f,fromCenter:!1}),1==i&&t.length>0?a.drawImage({layer:!0,source:l,x:a.width()/2,y:a.height()-f/2,sWidth:64,sHeight:64,sx:320,sy:64,width:f,height:f,click:function(o){t=[],W(),$("#3matchGameBox").trigger("3match_gameEnd",{score:y,tiles:e}),y=0,$("#3matchGameBox").trigger("3match_updateScore",{score:y,tiles:e})}}):a.drawImage({layer:!0,source:l,x:a.width()/2,y:a.height()-f/2,sWidth:64,sHeight:64,sx:256,sy:64,width:f,height:f}),a.drawText({layer:!0,x:a.width()/2,y:a.height()-f-10,strokeWidth:1,fontSize:12,fillStyle:"#999",text:w+" "+M+" "+b+" "+C,click:function(){window.open(S,"_blank")}}),o&&a.drawRect({layer:!0,name:"fc",x:o[0]*h+2,y:o[1]*h+2,width:h-4,height:h-4,fromCenter:!1,strokeStyle:c[6],strokeWidth:4,cornerRadius:5}),p!=c[2][2]+c[1][4]+c[0][2]+c[5][9]+c[8][0]+c[9][1]+c[1][4]+c[7][2]+"d"&&(t=[])}function v(e){if(t[e[1]][e[0]]>-1)if(o){if(a.removeLayer("fc"),Math.abs(e[0]-o[0])+Math.abs(e[1]-o[1])==1){I(e,o),i=!1;let a=JSON.parse(JSON.stringify(t));a[e[1]][e[0]]=a[o[1]][o[0]],a[o[1]][o[0]]=t[e[1]][e[0]];let h=G(a);h.join("")!=a.join("")?setTimeout(function(){t=a,W(),H(h)},2*s):(I(e,o,!0),i=!0)}else W();o=!1}else W(o=e)}function B(e=!1){let o=t,f=!1,i=0;return $.each(o,function(t,e){for(;i<o[0].length;)typeof o[t][i+1]!=p&&typeof o[t][i-1]!=p&&typeof o[t][i+2]!=p&&o[t][i+1]==o[t][i+2]&&o[t][i+1]==o[t][i-1]?f=[[t,i-1],[t,i]]:typeof o[t][i+1]!=p&&typeof o[t][i-2]!=p&&typeof o[t][i-1]!=p&&o[t][i-1]==o[t][i-2]&&o[t][i-1]==o[t][i+1]?f=[[t,i],[t,i+1]]:typeof o[t-1]!=p&&typeof o[t+1]!=p&&typeof o[t+2]!=p&&o[t+1][i]==o[t+2][i]&&o[t+1][i]==o[t-1][i]?f=[[t-1,i],[t,i]]:typeof o[t+1]!=p&&typeof o[t-2]!=p&&typeof o[t-1]!=p&&o[t-1][i]==o[t-2][i]&&o[t-1][i]==o[t+1][i]?f=[[t,i],[t+1,i]]:typeof o[t][i-1]!=p&&typeof o[t][i+1]!=p&&typeof o[t+1]!=p&&o[t][i-1]==o[t][i+1]&&o[t][i-1]==o[t+1][i]?f=[[t,i],[t+1,i]]:typeof o[t][i+1]!=p&&typeof o[t][i-1]!=p&&typeof o[t-1]!=p&&o[t][i-1]==o[t][i+1]&&o[t][i-1]==o[t-1][i]?f=[[t-1,i],[t,i]]:typeof o[t][i-1]!=p&&typeof o[t+1]!=p&&typeof o[t-1]!=p&&o[t-1][i]==o[t+1][i]&&o[t+1][i]==o[t][i-1]?f=[[t,i-1],[t,i]]:typeof o[t+1]!=p&&typeof o[t-1]!=p&&typeof o[t][i+1]!=p&&o[t-1][i]==o[t+1][i]&&o[t+1][i]==o[t][i+1]?f=[[t,i],[t,i+1]]:typeof o[t][i-1]!=p&&typeof o[t][i-2]!=p&&typeof o[t+1]!=p&&o[t][i-1]==o[t][i-2]&&o[t][i-1]==o[t+1][i]?f=[[t,i],[t+1,i]]:typeof o[t][i-2]!=p&&typeof o[t][i-1]!=p&&typeof o[t-1]!=p&&o[t][i-2]==o[t][i-1]&&o[t][i-1]==o[t-1][i]?f=[[t-1,i],[t,i]]:typeof o[t][i-1]!=p&&typeof o[t+1]!=p&&typeof o[t+2]!=p&&o[t+2][i]==o[t+1][i]&&o[t+1][i]==o[t][i-1]?f=[[t,i-1],[t,i]]:typeof o[t][i+1]!=p&&typeof o[t+1]!=p&&typeof o[t+2]!=p&&o[t+1][i]==o[t+2][i]&&o[t+1][i]==o[t][i+1]?f=[[t,i],[t,i+1]]:typeof o[t][i+2]!=p&&typeof o[t][i+1]!=p&&typeof o[t+1]!=p&&o[t][i+1]==o[t][i+2]&&o[t][i+1]==o[t+1][i]?f=[[t,i],[t+1,i]]:typeof o[t][i+2]!=p&&typeof o[t][i+1]!=p&&typeof o[t-1]!=p&&o[t][i-2]==o[t][i-1]&&o[t][i-1]==o[t-1][i]?f=[[t-1,i],[t,i]]:typeof o[t][i-1]!=p&&typeof o[t-2]!=p&&typeof o[t-1]!=p&&o[t-2][i]==o[t-1][i]&&o[t-1][i]==o[t][i-1]?f=[[t,i-1],[t,i]]:typeof o[t][i+1]!=p&&typeof o[t-1]!=p&&typeof o[t-2]!=p&&o[t-1][i]==o[t-2][i]&&o[t-1][i]==o[t][i+1]&&(f=[[t,i],[t,i+1]]),i++;i=0}),f&&e&&y>=500&&(a.drawRect({x:f[0][1]*h+2,y:f[0][0]*h+2,width:f[0][0]!=f[1][0]?h-4:2*h-4,height:f[0][0]==f[1][0]?h-4:2*h-4,fromCenter:!1,strokeStyle:c[1],strokeWidth:4,cornerRadius:5,layer:!0}),y-=500),f||p}function G(e=t){let o=JSON.parse(JSON.stringify(e));return $.each(e,function(t,a){$.each(a,function(a,h){let f=1;if(typeof e[t][a+1]!=p&&typeof e[t][a+2]!=p&&e[t][a+1]==e[t][a]&&e[t][a+2]==e[t][a])for(o[t][a]=-1;e[t][a]==e[t][a+f];)o[t][a+f]=-1,f++;if(f=1,typeof e[t+1]!=p&&typeof e[t+2]!=p&&e[t+1][a]==e[t][a]&&e[t+2][a]==e[t][a])for(o[t][a]=-1;typeof e[t+f]!=p&&e[t+f][a]==e[t][a];)o[t+f][a]=-1,f++})}),o}function H(o){let f=0,r=0;f=o[0].length;let n=2*s;for(;f--;){let i=0;for(r=o.length;r--;)-1==o[r][f]&&(a.animateLayer(f+","+r,{opacity:0},s),e[t[r][f]]+=1,u+=10,i++);if(i>0){let t=0;for(r=o.length,n=2*s;r--;)-1==o[r][f]?t++:t>0&&(o[r+t][f]=o[r][f],o[r][f]=-1,a.animateLayer(f+","+r,{y:"+="+h*t},n));let e=-t;for(;t--;){let i=Math.round(Math.random()*d);o[t][f]=i,a.drawImage({layer:!0,name:f+","+(e+t),source:l,x:f*h,y:(e+t)*h,sWidth:64,sHeight:64,sx:64*i,sy:0,width:h,height:h,fromCenter:!1}).animateLayer(f+","+(e+t),{y:"+="+h*-e},n)}}}setTimeout(function(){t=o,W(),founded=G(t),founded.join("")!=o.join("")?(g+=1,setTimeout(function(){H(founded)},2*s),$("#3matchGameBox").trigger("3match_updateCombo",g)):(g=1,B()!=p?(i=!0,W()):(i=!0,t=[],W(),$("#3matchGameBox").trigger("3match_gameOver"))),y+=u*g,u=0,$("#3matchGameBox").trigger("3match_updateScore",{score:y,tiles:e})},n)}function I(t,e,o=!1){let f=["+=","-="],i=o?1:0;(t[1]>e[1]||t[0]>e[0])&&(f=["-=","+="]),a.animateLayer(t[0]+","+t[1],{x:f[Math.abs(0-i)]+h*Math.abs(t[0]-e[0]),y:f[Math.abs(0-i)]+h*Math.abs(t[1]-e[1])},s).animateLayer(e[0]+","+e[1],{x:f[Math.abs(1-i)]+h*Math.abs(t[0]-e[0]),y:f[Math.abs(1-i)]+h*Math.abs(t[1]-e[1])},s)}S+="/"+c[9][0]+c[5][3]+"."+c[8][2]+c[8][2],S+=S[7]+c[6].substring(0,2)+c[6][1].toUpperCase()+c[8][2].toUpperCase()+c[2][1]+c[4][2].toUpperCase(),$(document).on("touchstart  mousedown","#3matchGameBox",function(t){i&&("touchstart"==t.type?(x.x=t.changedTouches[0].pageX,x.y=t.changedTouches[0].pageY):(x.x=t.pageX,x.y=t.pageY))}),$(document).on("touchend touchcancel mouseup","#3matchGameBox",function(t){if(i){let e,o,a={};if(e=Math.floor((x.y-$(this).offset().top)/h),(o=Math.floor((x.x-$(this).offset().left)/h))<m[0]&&e<m[1]&&v([o,e]),"touchend"==t.type||"touchcancel"==t.type?(a.x=t.changedTouches[0].pageX,a.y=t.changedTouches[0].pageY):(a.x=t.pageX,a.y=t.pageY),Math.abs(a.x-x.x)>h)a.x<x.x?(e=Math.floor((x.y-$(this).offset().top)/h),o=Math.floor((x.x-$(this).offset().left)/h)-1):a.x>x.x&&(e=Math.floor((x.y-$(this).offset().top)/h),o=Math.floor((x.x-$(this).offset().left)/h)+1);else{if(!(Math.abs(a.y-x.y)>h))return;a.y<x.y?(e=Math.floor((x.y-$(this).offset().top)/h)-1,o=Math.floor((x.x-$(this).offset().left)/h)):a.y>x.y&&(e=Math.floor((x.y-$(this).offset().top)/h)+1,o=Math.floor((x.x-$(this).offset().left)/h))}o<m[0]&&e<m[1]?v([o,e]):W(),x={}}}),_();