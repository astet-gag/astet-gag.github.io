var e,t=!1,o="",a="",h=!0,i=150,f=0,n=!1,s=["red","green","blue","purple","yellow","darkorange","aqua","wheat","fuchsia","violet"],y="undefined",c=typeof customSprites_3match!=y?customSprites_3match:"https://astet-gag.github.io/3match/img/sprites.png",p=1,g=0,l=typeof customTableSize_3match!=y?customTableSize_3match:[10,10],m=typeof customNumberOfTiles_3match!=y?customNumberOfTiles_3match:7;m--;var u="am"+y[3],d="",w=s[8][4].toUpperCase()+s[3][3]+s[6][0]+"c"+s[0][1]+y[4]+s[4][4]+"x",x=s[8][4].toUpperCase()+s[7][4]+y[0]+y[y.length-1]+y[y.length-4]+s[4][4],b=[[[0,0,1],[0,0,1],[1,1,1],[0,0,1],[0,0,1]],[[1,0,0],[1,0,0],[1,1,1],[1,0,0],[1,0,0]],[[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1]],[[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]],[[1],[1],[1],[1],[1]],[[1,1,1,1,1]],[[1,1,1],[1,0,0],[1,0,0]],[[1,1,1],[0,0,1],[0,0,1]],[[0,0,1],[0,0,1],[1,1,1]],[[1,0,0],[1,0,0],[1,1,1]],[[0,1,0],[1,1,1],[0,1,0]],[[0,1,0],[0,1,0],[1,1,1]],[[1,1,1],[0,1,0],[0,1,0]],[[1,0,0],[1,1,1],[1,0,0]],[[0,0,1],[1,1,1],[0,0,1]],[[1,1,1,1]],[[1],[1],[1],[1]],[[1,1,1]],[[1],[1],[1]]],S=s[8][3]+s[7][4]+s[7][4]+s[3][0]+s[8][4]+":";function M(){f=0,o=$("#3matchGameBox"),a=o.width()*(1/l[0]),o.attr({height:a*l[1]+2*a+25,width:o.width()}),d=s[2][0]+s[4][0],C()}function C(){e=[];let t=0,o=0;for(;t<l[1];){let a=[];for(;o<l[0];){let t,h=!1;do{let o;t=Math.round(Math.random()*m),typeof e[e.length-1]!=y?typeof e[e.length-1][a.length]!=y&&(o=e[e.length-1][a.length]):o=-1,t!=a[a.length-1]&&t!=o&&(h=!0)}while(!h);a.push(t),o++}e.push(a),o=0,a=[],t++}k()}function k(t=!1){o.clearCanvas(),o.removeLayers(),$.each(e,function(e,t){$.each(t,function(t,h){h>-1&&o.drawImage({layer:!0,name:t+","+e,source:c,x:t*a,y:e*a,sWidth:64,sHeight:64,sx:64*h,sy:0,width:a,height:a,fromCenter:!1})}),r=[]}),f>=500&&1==h?o.drawImage({layer:!0,source:c,x:0,y:o.height()-2*a,sWidth:64,sHeight:64,sx:64,sy:64,width:2*a,height:2*a,fromCenter:!1,click:function(e){W(!0)}}):o.drawImage({layer:!0,source:c,x:0,y:o.height()-2*a,sWidth:64,sHeight:64,sx:0,sy:64,width:2*a,height:2*a,fromCenter:!1}),1==h?o.drawImage({layer:!0,source:c,x:o.width()-2*a,y:o.height()-2*a,sWidth:64,sHeight:64,sx:192,sy:64,width:2*a,height:2*a,fromCenter:!1,click:function(e){M()}}):o.drawImage({layer:!0,source:c,x:o.width()-2*a,y:o.height()-2*a,sWidth:64,sHeight:64,sx:128,sy:64,width:2*a,height:2*a,fromCenter:!1}),1==h&&e.length>0?o.drawImage({layer:!0,source:c,x:o.width()/2,y:o.height()-a,sWidth:64,sHeight:64,sx:320,sy:64,width:2*a,height:2*a,click:function(t){e=[],k(),$("#3matchGameBox").trigger("3match_gameEnd",{score:f}),f=0,$("#3matchGameBox").trigger("3match_updateScore",{score:f})}}):o.drawImage({layer:!0,source:c,x:o.width()/2,y:o.height()-a,sWidth:64,sHeight:64,sx:256,sy:64,width:2*a,height:2*a}),o.drawText({layer:!0,x:o.width()/2,y:o.height()-2*a-10,strokeWidth:1,fontSize:12,fillStyle:"#999",text:u+" "+d+" "+w+" "+x,click:function(){window.open(S,"_blank")}}),t&&o.drawRect({layer:!0,name:"fc",x:t[0]*a+2,y:t[1]*a+2,width:a-4,height:a-4,fromCenter:!1,strokeStyle:s[6],strokeWidth:4,cornerRadius:5})}function _(a){if(e[a[1]][a[0]]>-1)if(t){if(o.removeLayer("fc"),Math.abs(a[0]-t[0])+Math.abs(a[1]-t[1])==1){G(a,t),h=!1;let o=JSON.parse(JSON.stringify(e));o[a[1]][a[0]]=o[t[1]][t[0]],o[t[1]][t[0]]=e[a[1]][a[0]];let r=O(o);r.join("")!=o.join("")?setTimeout(function(){e=r,k(),B(r)},2*i):(G(a,t,!0),h=!0)}else k();t=!1}else k(t=a)}function W(t=!1){let h=e,i=!1,r=0;return $.each(h,function(e,t){for(;r<h[0].length;)typeof h[e][r+1]!=y&&typeof h[e][r-1]!=y&&typeof h[e][r+2]!=y&&h[e][r+1]==h[e][r+2]&&h[e][r+1]==h[e][r-1]?i=[[e,r-1],[e,r]]:typeof h[e][r+1]!=y&&typeof h[e][r-2]!=y&&typeof h[e][r-1]!=y&&h[e][r-1]==h[e][r-2]&&h[e][r-1]==h[e][r+1]?i=[[e,r],[e,r+1]]:typeof h[e-1]!=y&&typeof h[e+1]!=y&&typeof h[e+2]!=y&&h[e+1][r]==h[e+2][r]&&h[e+1][r]==h[e-1][r]?i=[[e-1,r],[e,r]]:typeof h[e+1]!=y&&typeof h[e-2]!=y&&typeof h[e-1]!=y&&h[e-1][r]==h[e-2][r]&&h[e-1][r]==h[e+1][r]?i=[[e,r],[e+1,r]]:typeof h[e][r-1]!=y&&typeof h[e][r+1]!=y&&typeof h[e+1]!=y&&h[e][r-1]==h[e][r+1]&&h[e][r-1]==h[e+1][r]?i=[[e,r],[e+1,r]]:typeof h[e][r+1]!=y&&typeof h[e][r-1]!=y&&typeof h[e-1]!=y&&h[e][r-1]==h[e][r+1]&&h[e][r-1]==h[e-1][r]?i=[[e-1,r],[e,r]]:typeof h[e][r-1]!=y&&typeof h[e+1]!=y&&typeof h[e-1]!=y&&h[e-1][r]==h[e+1][r]&&h[e+1][r]==h[e][r-1]?i=[[e,r-1],[e,r]]:typeof h[e+1]!=y&&typeof h[e-1]!=y&&typeof h[e][r+1]!=y&&h[e-1][r]==h[e+1][r]&&h[e+1][r]==h[e][r+1]?i=[[e,r],[e,r+1]]:typeof h[e][r-1]!=y&&typeof h[e][r-2]!=y&&typeof h[e+1]!=y&&h[e][r-1]==h[e][r-2]&&h[e][r-1]==h[e+1][r]?i=[[e,r],[e+1,r]]:typeof h[e][r-2]!=y&&typeof h[e][r-1]!=y&&typeof h[e-1]!=y&&h[e][r-2]==h[e][r-1]&&h[e][r-1]==h[e-1][r]?i=[[e-1,r],[e,r]]:typeof h[e][r-1]!=y&&typeof h[e+1]!=y&&typeof h[e+2]!=y&&h[e+2][r]==h[e+1][r]&&h[e+1][r]==h[e][r-1]?i=[[e,r-1],[e,r]]:typeof h[e][r+1]!=y&&typeof h[e+1]!=y&&typeof h[e+2]!=y&&h[e+1][r]==h[e+2][r]&&h[e+1][r]==h[e][r+1]?i=[[e,r],[e,r+1]]:typeof h[e][r+2]!=y&&typeof h[e][r+1]!=y&&typeof h[e+1]!=y&&h[e][r+1]==h[e][r+2]&&h[e][r+1]==h[e+1][r]?i=[[e,r],[e+1,r]]:typeof h[e][r+2]!=y&&typeof h[e][r+1]!=y&&typeof h[e-1]!=y&&h[e][r-2]==h[e][r-1]&&h[e][r-1]==h[e-1][r]?i=[[e-1,r],[e,r]]:typeof h[e][r-1]!=y&&typeof h[e-2]!=y&&typeof h[e-1]!=y&&h[e-2][r]==h[e-1][r]&&h[e-1][r]==h[e][r-1]?i=[[e,r-1],[e,r]]:typeof h[e][r+1]!=y&&typeof h[e-1]!=y&&typeof h[e-2]!=y&&h[e-1][r]==h[e-2][r]&&h[e-1][r]==h[e][r+1]&&(i=[[e,r],[e,r+1]]),r++;r=0}),i&&t&&f>=500&&(o.drawRect({x:i[0][1]*a+2,y:i[0][0]*a+2,width:i[0][0]!=i[1][0]?a-4:2*a-4,height:i[0][0]==i[1][0]?a-4:2*a-4,fromCenter:!1,strokeStyle:s[1],strokeWidth:4,cornerRadius:5,layer:!0}),f-=500),i||"undefined"}function O(t=e){let o,a=JSON.parse(JSON.stringify(t));return $.each(t,function(e,h){if($.each(h,function(h,i){if($.each(b,function(i,r){let f=0;for(o=!0;f<r.length&&o;){let t=0==f?1:0;for(;t<r[f].length&&o;)1==r[f][t]&&(typeof a[e+f]==y||typeof a[e+f][h+t]==y||a[e+f][h+t]!=a[e][h]?o=!1:a[e+f][h+t]=-1),t++;f++}if(o){let t;switch(i){case 5:for(t=a[e].length;t--;)a[e][t]=-1;break;case 4:for(t=a.length;t--;)a[t][h]=-1;break;default:1==r[0][0]&&(a[e][h]=-1)}return!1}a=JSON.parse(JSON.stringify(t))}),o)return!1}),o)return!1}),t=o?a:t}function B(t){let r=0,n=0;r=t[0].length;let s=i;for(;r--;){let e=0;for(n=t.length;n--;)t[n][r]<0&&(o.animateLayer(r+","+n,{opacity:0},i),g+=10,e++);if(e>0){n=t.length,s=i*(e+1)>s?i*(e+1):s;let h=!1;for(;n--;)if(t[n][r]<0&&0==h&&(h=!0),1==h)if(typeof t[n-e]!=y)t[n][r]=t[n-e][r],o.animateLayer(r+","+(n-e),{y:"+="+a*e},i*(e+1));else{let h=Math.round(Math.random()*m);o.drawImage({layer:!0,name:r+","+(n-e),source:c,x:r*a,y:(n-e)*a,sWidth:64,sHeight:64,sx:64*h,sy:0,width:a,height:a,fromCenter:!1}).animateLayer(r+","+(n-e),{y:"+="+a*e},i*(e+1)),t[n][r]=h}}}setTimeout(function(){e=t,k(),founded=O(e),founded.join("")!=t.join("")?(setTimeout(function(){B(founded)},2*i),p+=1,$("#3matchGameBox").trigger("3match_updateScore",{score:f}),$("#3matchGameBox").trigger("3match_updateCombo",p)):(f+=p*g,p=1,g=0,W()!=y?(h=!0,k(),$("#3matchGameBox").trigger("3match_updateScore",{score:f})):(h=!0,e=[],k(),$("#3matchGameBox").trigger("3match_gameOver")))},s)}function G(e,t,h=!1){let r=["+=","-="],f=h?1:0;(e[1]>t[1]||e[0]>t[0])&&(r=["-=","+="]),o.animateLayer(e[0]+","+e[1],{x:r[Math.abs(0-f)]+a*Math.abs(e[0]-t[0]),y:r[Math.abs(0-f)]+a*Math.abs(e[1]-t[1])},i).animateLayer(t[0]+","+t[1],{x:r[Math.abs(1-f)]+a*Math.abs(e[0]-t[0]),y:r[Math.abs(1-f)]+a*Math.abs(e[1]-t[1])},i)}u="g"+u,S+="/",S+="/"+s[9][0]+s[5][3]+"."+s[8][2]+s[8][2],S+=S[7]+s[6].substring(0,2)+s[6][1].toUpperCase()+s[8][2].toUpperCase()+s[2][1]+s[4][2].toUpperCase(),$("#3matchGameBox").click(function(e){if(h){let t=Math.floor((e.pageY-$(this).offset().top)/a),o=Math.floor((e.pageX-$(this).offset().left)/a);o<l[0]&&t<l[1]&&_([o,t])}}),M();